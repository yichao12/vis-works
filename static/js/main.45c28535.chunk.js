(this["webpackJsonpvis-works"]=this["webpackJsonpvis-works"]||[]).push([[0],{129:function(e,t,a){},136:function(e,t,a){e.exports=a.p+"static/media/f1.59fa5dea.jpg"},137:function(e,t,a){e.exports=a.p+"static/media/f2.6ca750b9.jpg"},138:function(e,t,a){e.exports=a.p+"static/media/f3.bbcb8a3d.jpg"},139:function(e,t,a){e.exports=a.p+"static/media/f4.24cc3d72.jpg"},140:function(e,t,a){e.exports=a.p+"static/media/f5.d66bc7ad.jpg"},141:function(e,t,a){e.exports=a.p+"static/media/f3a.3dc33cc2.jpg"},142:function(e,t,a){e.exports=a.p+"static/media/fire.328c90f2.png"},167:function(e,t,a){e.exports=a(266)},172:function(e,t,a){},173:function(e,t,a){},175:function(e,t,a){},176:function(e,t,a){},177:function(e,t,a){},179:function(e,t,a){},266:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(10),i=a.n(o),s=(a(172),a(13)),c=a(14),l=a(16),u=a(15),h=a(17),f=a(45),p=a(38),m=(a(173),a(174),a(271)),v=(a(175),a(41)),d=(a(176),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={selectFloor:""},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){this.setTime(),setInterval(this.setTime.bind(this),6e4)}},{key:"setTime",value:function(){this.setState({curTime:(new Date).toLocaleString().slice(0,-3)})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("h2",{className:"title"},"\u697c\u5c42\u706b\u707e\u6001\u52bf\u611f\u77e5"),r.a.createElement("div",{className:"sub-title-container"},r.a.createElement("h3",{className:"sub-title"},"\u5730\u70b9"),r.a.createElement("h3",{className:"sub-title"},this.state.curTime)),r.a.createElement(v.Chart,{height:330,data:this.props.data,padding:50,scale:{percent:{type:"linear",min:0,max:100}},forceFit:!0,onGetG2Instance:function(t){e.chartIns=t},onPlotClick:function(t){var a={x:t.x,y:t.y},n=e.chartIns.getTooltipItems(a)[0].point.point.floor;e.setState({selectFloor:n});var r=0;e.props.data.map((function(e){e.floor==n&&(r+=e.percent)})),e.props.selectFloor(n,r/100)}},r.a.createElement(v.Legend,{position:"top"}),r.a.createElement(v.Axis,{name:"\u697c\u5c42",title:"\u697c\u5c42"}),r.a.createElement(v.Axis,{name:"\u8fc7\u706b\u91cf"}),r.a.createElement(v.Tooltip,null),r.a.createElement(v.Geom,{type:"intervalStack",position:"floor*percent",color:["type",function(e){var t=["#ad2102","#d4380d"];return"\u4e0a\u4e00\u65f6\u523b"==e?t[0]:t[1]}],opacity:["floor",function(t){return""==e.state.selectFloor?1:t==e.state.selectFloor?1:.3}],style:{stroke:"#fff",lineWidth:1},tooltip:["floor*percent*type",function(e,t,a){return{name:"\u697c\u5c42:"+e,title:a,value:"\u8fc7\u706b\u91cf"+t+"%"}}]},r.a.createElement(v.Label,{content:"name",formatter:function(t,a,n){var r=a.point,o=0;return e.props.data.map((function(e){e.floor==r.floor&&(o+=e.percent)})),"\u65b0\u589e\u533a\u57df"==r.type?o+"%":null},textStyle:{fill:"white",fontSize:"12",fontWeight:"bold"}}))))}}]),t}(r.a.Component)),y=(a(177),a(136)),g=a.n(y),x=a(137),b=a.n(x),j=a(138),O=a.n(j),k=a(139),E=a.n(k),w=a(140),M=a.n(w),T=a(141),I=a.n(T),C=function(e){this.r=6*Math.random(),this.x=-100,this.y=-100,this.vy=-5+parseInt(10*Math.random()),this.vx=-5+parseInt(10*Math.random()),this.isFree=!1,this.a=Math.random(),this.draw=function(){e.beginPath(),e.fillStyle="rgba(250, 84, 28, "+this.a+")",e.arc(this.x,this.y,this.r,0,2*Math.PI,!1),e.fill(),e.closePath()},this.setPos=function(e,t){this.x=e,this.y=t}};function L(e,t,a,n,r,o,i){n=void 0!==n&&null!==n?n:25,r=void 0!==r&&null!==r?r:6,o=void 0!==o&&null!==o?o:1,i=void 0!==i&&null!==i?i:"#000";var s=180*Math.atan2(t.y-a.y,t.x-a.x)/Math.PI,c=(s+n)*Math.PI/180,l=(s-n)*Math.PI/180,u=r*Math.cos(c),h=r*Math.sin(c),f=r*Math.cos(l),p=r*Math.sin(l);e.save(),e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(a.x,a.y);var m=a.x+u,v=a.y+h;e.moveTo(m,v),e.lineTo(a.x,a.y),m=a.x+f,v=a.y+p,e.lineTo(m,v),e.strokeStyle=i,e.lineWidth=o,e.stroke(),e.restore()}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var a=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var o=Object.keys(Object(r)),i=0,s=o.length;i<s;i++){var c=o[i],l=Object.getOwnPropertyDescriptor(r,c);void 0!==l&&l.enumerable&&(a[c]=r[c])}}return a}});var S=function(e,t,a,n){var r={startOffset:2,endOffset:2,offset:0,color:"#E6E6FA",activeIndex:-1,activeColor:"#00FF00",stepLength:5,justifyAlign:!0,arrowLength:10,arrowTheta:25,arrowHeadlen:4,arrowLineWidth:1,lineWidth:1};void 0!==n&&null!==n&&(r=Object.assign(r,n));var o=Math.floor(Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2))),i=Math.floor((o-(r.startOffset+r.offset+r.endOffset)+r.stepLength)/(r.arrowLength+r.stepLength));!0===r.justifyAlign&&(r.stepLength=(o-(r.startOffset+r.offset+r.endOffset)-r.arrowLength*i)/(i-1));var s=0;r.activeIndex>0&&(s=r.activeIndex%i===0?i:r.activeIndex%i);for(var c,l,u=Math.atan2(t.y-a.y,a.x-t.x),h=t.x,f=t.y,p=0;p<i;p++)c=r.startOffset+r.offset+(r.arrowLength+r.stepLength)*p,t={x:h+Math.cos(u)*c,y:f-Math.sin(u)*c},c+=r.arrowLength,a={x:h+Math.cos(u)*c,y:f-Math.sin(u)*c},l=s>0&&p===s-1?r.activeColor:r.color,L(e,t,a,r.arrowTheta,r.arrowHeadlen,r.arrowLineWidth,l)},F={f1:g.a,f2:b.a,f3:O.a,f3a:I.a,f4:E.a,f5:M.a};function P(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}var W=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={},a.canvas=r.a.createRef(),a.TrajsCanvas=r.a.createRef(),a.floorTrajs={f1:{origin:{x:350,y:150},trajs:[[{x:350,y:150},{x:360,y:70}],[{x:360,y:70},{x:400,y:60}],[{x:350,y:150},{x:400,y:100}],[{x:350,y:150},{x:420,y:120}],[{x:350,y:150},{x:400,y:160}]]},f2:{origin:{x:550,y:150},trajs:[[{x:550,y:150},{x:520,y:100}],[{x:550,y:150},{x:520,y:210}],[{x:550,y:150},{x:590,y:100}],[{x:550,y:150},{x:600,y:130}],[{x:550,y:150},{x:600,y:160}]]},f3:{origin:{x:350,y:150},trajs:[[{x:350,y:150},{x:350,y:70}],[{x:350,y:70},{x:320,y:70}],[{x:350,y:150},{x:300,y:200}],[{x:350,y:150},{x:380,y:70}],[{x:350,y:150},{x:380,y:170}]]},f3a:{origin:{x:550,y:200},trajs:[[{x:550,y:200},{x:570,y:130}],[{x:550,y:200},{x:590,y:150}],[{x:550,y:200},{x:580,y:190}]]},f4:{origin:{x:450,y:150},trajs:[[{x:450,y:150},{x:510,y:100}],[{x:510,y:100},{x:480,y:90}],[{x:450,y:150},{x:500,y:200}],[{x:450,y:150},{x:400,y:100}],[{x:390,y:100},{x:410,y:75}]]},f5:{origin:{x:550,y:150},trajs:[[{x:550,y:150},{x:410,y:120}],[{x:410,y:120},{x:410,y:90}],[{x:550,y:150},{x:520,y:100}],[{x:550,y:150},{x:600,y:100}]]}},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){console.log(this.canvas),this.drawBurns()}},{key:"drawBurns",value:function(){var e=this.canvas;if(e&&e.current){var t=(e=this.canvas.current).clientHeight,a=e.clientWidth,n=e.getContext("2d"),r=[],o=50,i=210,s=25,c=100,l=this.props.percent,u={f1:[90,30],f2:[120,70],f3:[160,40],f3a:[120,60],f4:[100,70],f5:[110,30]}[this.props.floor],h=u[0]-i*l/2,f=u[0]+i*l/2,p=u[1]-c*l/2,m=u[1]+c*l/2;h=h<o?o:h,p=p<s?s:p,f=f>o+i?o+i:f,m=m>s+c?s+c:m;for(var v=0;v<300*l;v++){var d=new C(n);d.x=P(h,f),d.y=P(p,m),r.push(d)}n.globalCompositeOperation="lighter";var y=setInterval((function(){n.clearRect(0,0,a,t),r.map((function(e){e.r+=.15,e.a-=.015,e.a<0&&(e.r=4*Math.random(),e.a=Math.random()),e.draw()}))}),1e3/30);this.setState({timeoutId:y})}}},{key:"drawTrajs",value:function(){var e=this.TrajsCanvas;if(e&&e.current){(e=this.TrajsCanvas.current).clientHeight,e.clientWidth;e.width=690,e.height=360;var t=e.getContext("2d"),a=1,n=this;setInterval((function(){var r=e.width,o=e.height;if(t.clearRect(0,0,r,o),n.props.floor)var i=n.floorTrajs[n.props.floor];else i=n.floorTrajs.f1;t.beginPath(),t.fillStyle="red",t.arc(i.origin.x,i.origin.y,3,0,2*Math.PI,!1),t.fill(),t.closePath();for(var s=a%3*5,c=0;c<i.trajs.length;c++)S(t,i.trajs[c][0],i.trajs[c][1],{offset:s,color:"red",justifyAlign:!1});a>=50?a=1:a++}),300)}}},{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement("h2",{className:"return-btn",onClick:this.props.return}," \u8fd4\u56de "),r.a.createElement("img",{src:F[this.props.floor]||F.f1,className:"image"}),r.a.createElement("canvas",{ref:this.canvas}),r.a.createElement("canvas",{ref:this.TrajsCanvas}))}}]),t}(r.a.Component),N=a(159),R=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={floor:"",percent:0},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){for(var e=["F1","F2","F3","F3a","F4","F5"],t=["\u65b0\u589e\u533a\u57df","\u4e0a\u4e00\u65f6\u523b"],a=[],n=0;n<e.length;n++)for(var r=0;r<t.length;r++){var o=Math.round(25*Math.random());"F4"==e[n]&&"\u65b0\u589e\u533a\u57df"==t[r]&&(o=25),"F4"==e[n]&&"\u4e0a\u4e00\u65f6\u523b"==t[r]&&(o=40),a.push({floor:e[n],type:t[r],percent:o})}this.setState({data:a})}},{key:"handleFlooeSelect",value:function(e,t){this.setState({floor:e.toLowerCase(),percent:t})}},{key:"handleReturn",value:function(){console.log("return"),this.setState({floor:""})}},{key:"render",value:function(){var e=r.a.createElement(d,{data:this.state.data,selectFloor:this.handleFlooeSelect.bind(this)}),t=r.a.createElement(W,{floor:this.state.floor,return:this.handleReturn.bind(this),percent:this.state.percent});return r.a.createElement("div",{className:"fire-app"},r.a.createElement("div",{className:"panel"},r.a.createElement(N.a,null,""==this.state.floor?e:t)))}}]),t}(r.a.Component),D=a(54),z=a(28),A=a(268),H=(a(179),a(142)),B=a.n(H),$=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){}},{key:"redirectTo",value:function(e){this.props.history.push(e)}},{key:"render",value:function(){var e={height:"300px"};return r.a.createElement("div",{className:"board-app"},r.a.createElement(D.a,{gutter:16},r.a.createElement(z.a,{span:8},r.a.createElement(A.a,{hoverable:!0,cover:r.a.createElement("img",{alt:"example",src:B.a,style:e}),onClick:this.redirectTo.bind(this,"/fire")},r.a.createElement(A.a.Meta,{title:"\u706b\u707e\u53ef\u89c6\u5316",description:"\u5c55\u793a\u5546\u57ce\u4e2d\u4e0d\u540c\u697c\u5c42\u7684\u706b\u707e\u60c5\u51b5"}))),r.a.createElement(z.a,{span:8},r.a.createElement(A.a,{hoverable:!0,cover:r.a.createElement("img",{alt:"example",style:e}),onClick:this.redirectTo.bind(this,"/urban")},r.a.createElement(A.a.Meta,{title:"\u57ce\u5e02\u53ef\u89c6\u5316",description:"\u4f7f\u7528 @antv/L7 \u8fdb\u884c\u5c55\u793a"})))),r.a.createElement("div",{className:"links-contain"},r.a.createElement("a",{href:"https://github.com/AgeBing/vis-works"},r.a.createElement(m.a,{shape:"circle",icon:"github"}))))}}]),t}(r.a.Component),q=Object(p.f)($),U=(a(129),a(9)),_=a.n(U),G=a(61),J=a(105),K=a(149),Y=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.createInstance()}},{key:"componentWillReceiveProps",value:function(e){if(this.props.hour!==e.hour&&this.props.hour){var t=e.hour;console.log("render",t),this.drawLinesUpdate(this.state.trajs[t])}}},{key:"createInstance",value:function(){var e=Object(G.a)(_.a.mark((function e(){var t,a;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,a=new K.Scene({id:"map",mapStyle:"light",center:[114.508266449,38.0413316426],pitch:60,zoom:13.8,zoomControl:!1,scaleControl:!1,attributionControl:!1}),this.scene=a,a.on("loaded",Object(G.a)(_.a.mark((function e(){var a,n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getKakous();case 2:return a=e.sent,e.next=5,t.getTrajs(a.map);case 5:n=e.sent,console.log(n),t.drawPoints(a.arr),t.setState({trajs:n});case 9:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getKakous",value:function(){var e=Object(G.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){J.a("http://q1vcletmu.bkt.clouddn.com/kakou.csv").then((function(t){var a=[],n=new Set,r=new Map;t.map((function(e){if("\u4e8c\u73af\u5185"==e.location){var t=e.I_ID,o=+e.longitude,i=+e.latitude;n.has(t)||(a.push({id:t,lng:o,lat:i,name:t}),r.set(t,{lng:o,lat:i})),n.add(e.I_ID)}})),console.log(a.length),e({arr:a,map:r})}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getTrajs",value:function(){var e=Object(G.a)(_.a.mark((function e(t){var a,n,r;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=[],n=function(e){var n=new Promise((function(a,n){var r="http://q1vcletmu.bkt.clouddn.com/t_df_"+e+".csv";J.a(r).then((function(e){var n=[];e.map((function(e){var a=e.s,r=e.e,o=t.get(a),i=t.get(""+r);o&&i&&n.push({lng1:o.lng,lat1:o.lat,lng2:i.lng,lat2:i.lat})})),console.log(n.length),a(n)}))}));a.push(n)},r=1;r<15;r++)n(r);return e.abrupt("return",Promise.all(a));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"drawPoints",value:function(e){var t=this.scene.PointLayer({zIndex:2}).source(e,{parser:{type:"json",x:"lng",y:"lat",name:"name"}}).shape("circle").size(1).active(!0).color("#ffc53d").style({opacity:.8,strokeWidth:0}).render();t.setHeight(10),t.on("click",(function(e){console.log(e)}))}},{key:"prepareLineLayer",value:function(){var e=this.scene.LineLayer({zIndex:3}).shape("line").size(3).color("#722ed1").style({opacity:.85}).animate({enable:!0,interval:.2,duration:2,trailLength:.4}).render();return console.log(e),e}},{key:"drawLinesUpdate",value:function(e){if(this.trajsLayer)console.log(e.length),this.trajsLayer.setData(e,{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}});else{var t=this.scene.LineLayer({zIndex:3}).source(e,{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}).shape("line").size(3).color("#40a9ff").style({opacity:.85}).animate({enable:!0,interval:.2,duration:2,trailLength:.4}).render();this.trajsLayer=t}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{id:"map",style:{width:"100%",margin:"0",height:"100%",position:"absolute"},ref:function(t){e.mapWrapper=t}})}}]),t}(n.Component),Q=a(70),V=a(270),X=a(269),Z=a(267),ee=(V.a.Countdown,Date.now(),3e3);function te(e){var t=new Date(2019,1,3,e,0,0,0);return t=t.format("hh:mm:ss")}Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};var ae={0:"0:00",6:"6:00",12:"12:00",18:"18:00",24:"24:00"},ne=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).onChange=function(e){a.setState({hour:e}),a.props.updateMapTime(e)},a.handleStartChange=function(e){var t=Object(Q.a)(a);if(e){var n=setInterval(t.timer.bind(t),ee);t.setState({startId:n})}else clearInterval(t.state.startId);a.setState({start:e})},a.state={hour:1,start:!1,startId:0},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){}},{key:"timer",value:function(){this.state.hour>=23&&clearInterval(this.state.startId);var e=this.state.hour+1;this.setState({hour:e}),this.props.updateMapTime(e)}},{key:"render",value:function(){var e=this.state,t=e.hour,a=e.start;return r.a.createElement("div",null,r.a.createElement(X.a,{min:0,max:24,marks:ae,onChange:this.onChange,value:"number"===typeof t?t:2}),r.a.createElement(V.a,{value:te(t)}),r.a.createElement(Z.a,{size:"small",checked:a,onChange:this.handleStartChange}))}}]),t}(r.a.Component),re=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(ne,{updateMapTime:this.props.updateMapTime}))}}]),t}(r.a.Component),oe=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){}},{key:"handleUpdateMapTime",value:function(e){console.log("map time",e),this.setState({mapTime:e})}},{key:"render",value:function(){return r.a.createElement("div",{className:"urban-app"},r.a.createElement(Y,{hour:this.state.mapTime}),r.a.createElement("div",{className:"widget-time"},r.a.createElement(re,{updateMapTime:this.handleUpdateMapTime.bind(this)})))}}]),t}(r.a.Component),ie=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={floor:"",percent:0},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillMount",value:function(){}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(f.a,{basename:"/vis-works"},r.a.createElement("div",{className:"home-btn"},r.a.createElement(f.b,{to:"/"},r.a.createElement(m.a,{shape:"circle",icon:"home"}))),r.a.createElement(p.c,null,r.a.createElement(p.a,{path:"/",exact:!0,component:q}),r.a.createElement(p.a,{path:"/urban",exact:!0,component:oe}),r.a.createElement(p.a,{path:"/fire",exact:!0,component:R}))))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(ie,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[167,1,2]]]);
//# sourceMappingURL=main.45c28535.chunk.js.map